import{a3 as W,c as E,j as z,m as D,r as h,o as e,S as I,p as d,B as f,I as _,T as y,a4 as F,N as M,x as T,y as v,z as j,a5 as U,V as A,a6 as V,a0 as $,a2 as G,a7 as H,a8 as O}from"./index-sksTnsI9.js";import"./UploadCard-ClgWKjtL.js";import{g as q,L as Q,u as J,a as X}from"./LightConeEditorCard-CZAQt_ad.js";import{L as Y,D as K}from"./BusinessCenter-BWIep7U2.js";import{u as Z}from"./useForceUpdate-DD2xvZNs.js";import{u as ee,a as te}from"./useInfScroll-C2wViwRw.js";import{L as ne,a as oe,b as ae,E as se,d as ie}from"./Add-Ds2XS8Nk.js";import{a as re,l as le,b as ce}from"./StatDisplay-BXqKWegt.js";import{s as he,l as de,P as pe}from"./PathIcon-XimyKRNS.js";import{C as P,G as k}from"./Grid-Db0g972N.js";function ge(n,s,p,i=[]){return(t,l)=>{for(const g of n){let m=0;const r=p[g],a=r(t),o=r(l);if(typeof a=="string"&&typeof o=="string"?m=a.localeCompare(o):m=o-a,m!==0)return i.includes(g)?m:(s?-1:1)*m}return 0}}const me=["level","name","rarity"];function ue(){return{level:n=>n.level*(n.ascension+1),name:n=>`lightConeNames_gen:${n.key}`,rarity:n=>W.lightCone[n.key].rarity}}const fe={name:["name"],level:["level","rarity","name"],rarity:["rarity","level","name"]},xe=E(z.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),Ce=E(z.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function ye({lightCone:n,onClick:s,onEdit:p,onDelete:i,onLockToggle:t,canEquip:l=!1,setLocation:g,extraButtons:m}){const{t:r}=D(["lightCone","lightCones_gen","common_gen"]),{key:a,level:o,ascension:C,superimpose:u,location:x="",lock:w}=n,S=h.useMemo(()=>he(de(a,o,C,u)),[C,a,o,u]),b=q(a);return e(h.Suspense,{fallback:e(I,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:350}}),children:d(j,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column"},children:[d(f,{className:`grad-${b.rarity}star`,sx:{position:"relative",width:"100%"},children:[!s&&!!t&&e(_,{color:"primary",onClick:t,sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:w?e(ne,{}):e(oe,{})}),d(f,{sx:{pt:2,px:2,position:"relative",zIndex:1},children:[d(f,{component:"div",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e(pe,{iconProps:{fontSize:"inherit"},pathKey:b.path}),e(y,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1},children:e("strong",{children:e(Q,{lcKey:a})})})]}),d(y,{component:"span",variant:"h5",children:[r("common_gen:lv")," ",o]}),d(y,{component:"span",variant:"h5",color:"text.secondary",children:["/",F[C]]}),d(y,{variant:"h6",children:[r("lightCones_gen:superimpose")," ",u]}),e(re,{stars:b.rarity,colored:!0})]}),e(f,{sx:{height:"100%",position:"absolute",right:0,top:0},children:e(f,{component:M?M:"img",alt:"Light Cone Image",src:le(a,"icon"),sx:{width:"auto",height:"90%",float:"right",marginBottom:"5%",marginTop:"5%",marginRight:"5%"}})})]}),e(P,{sx:{flexGrow:1,display:"flex",flexDirection:"column",pt:1,pb:"0!important",width:"100%"},children:["hp","atk","def"].map(c=>e(be,{calc:S,stat:c},c))}),d(f,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[e(f,{sx:{flexGrow:1},children:l&&g?e(Y,{locKey:x,setLocKey:g,getOptionDisabled:c=>!c.key,disableClearable:!0}):e(ae,{location:x})}),d(f,{display:"flex",gap:1,alignItems:"stretch",height:"100%",sx:{"& .MuiButton-root":{minWidth:0,height:"100%"}},children:[!!p&&e(T,{title:e(y,{children:r("edit")}),placement:"top",arrow:!0,children:e(v,{color:"info",size:"small",onClick:p,children:e(se,{})})}),!!i&&e(T,{title:w?r("cantDeleteLock"):"",placement:"top",children:e("span",{children:e(v,{color:"error",size:"small",onClick:i,disabled:!!x||w,sx:{top:"1px"},children:e(K,{})})})}),m]})]})]})})}function be({calc:n,stat:s}){return d(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(ce,{statKey:s}),e("span",{children:n.compute(U.base[s].with("sheet","lightCone")).val.toFixed()})]},s)}function ve({lightConeIdToEdit:n="",cancelEdit:s}){const{t:p}=D(["lightCone","common"]),{database:i}=A(),t=J(n),[l,g]=h.useState(void 0);h.useEffect(()=>{t&&g(structuredClone(t))},[t]),h.useEffect(()=>{n==="new"&&g({level:1,ascension:0,superimpose:1})},[n]);const m=h.useCallback(u=>{g(x=>({...x,...u}))},[]),r=h.useCallback(()=>{s(),g(void 0)},[s]),a=h.useCallback(u=>{if(l!=null&&l.key&&!window.confirm(p("editor.clearPrompt"))){u==null||u.preventDefault();return}r()},[p,l,r]),o=h.useMemo(()=>V(l),[l]),C=h.useMemo(()=>d(f,{display:"flex",gap:2,children:[e(v,{startIcon:e(xe,{}),onClick:()=>{o&&i.lightCones.new(o),r()},disabled:!o,color:"primary",children:p("editor.btnAdd")}),o&&t&&e(v,{startIcon:e(Ce,{}),onClick:()=>{o&&i.lightCones.set(t.id,o),r()},disabled:!o,color:"success",children:p("editor.btnUpdate")}),!!(t!=null&&t.id)&&e(v,{startIcon:e(K,{}),onClick:()=>{window.confirm(p("editor.confirmDelete"))&&(i.lightCones.remove(t.id),r())},disabled:!(t!=null&&t.id),color:"error",sx:{top:"2px"},children:p("common:delete")})]}),[r,i,t,p,o]);return e(h.Suspense,{fallback:!1,children:l&&e($,{open:!!l,onClose:a,children:e(X,{onClose:a,lightCone:l,setLightCone:m,footer:C})})})}const N={xs:1,sm:2,md:3,lg:3,xl:4},we={xs:10,sm:12,md:24,lg:24,xl:24};function Se({onAdd:n,onEdit:s}){const{t:p}=D("lightCone"),{database:i}=A(),[t,l]=Z(),g=()=>({sortType:me[0],ascending:!1,rarity:[...H],path:[...O]}),{sortType:m,ascending:r}=g();h.useEffect(()=>i.lightCones.followAny(l),[i,l]);const{lightConeIds:a,totalLightConeNum:o}=h.useMemo(()=>{const c=i.lightCones.values,L=c.length,B=c.sort(ge(fe[m]??[],r,ue())).map(R=>R.id);return t&&{lightConeIds:B,totalLightConeNum:L}},[i,t,m,r]),C=ee(),u=a.length!==o?`${a.length}/${o}`:`${o}`,{numShow:x,setTriggerElement:w}=te(we[C],a.length),S=h.useMemo(()=>a.slice(0,x),[a,x]),b={numShowing:S.length,total:u};return d(G,{children:[e(j,{bgt:"dark",children:e(P,{children:e(f,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:d(y,{color:"text.secondary",children:["Showing ",e("b",{children:b.numShowing})," out of"," ",b.total," Items"]})})})}),e(k,{container:!0,columns:N,spacing:1,children:e(k,{item:!0,xs:!0,children:e(v,{fullWidth:!0,onClick:n,color:"info",startIcon:e(ie,{}),children:p("addNew")})})}),d(h.Suspense,{fallback:e(I,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:[e(k,{container:!0,columns:N,spacing:1,children:S.map(c=>e(k,{item:!0,xs:1,children:e(ye,{lightCone:i.lightCones.get(c),onEdit:()=>s==null?void 0:s(c),onDelete:()=>i.lightCones.remove(c),setLocation:L=>i.lightCones.set(c,{location:L}),canEquip:!0})},c))}),a.length!==S.length&&e(I,{ref:c=>{c&&w(c)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function Ae(){const[n,s]=h.useState("");return d(f,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(ve,{lightConeIdToEdit:n,cancelEdit:()=>s("")}),e(Se,{onAdd:()=>s("new"),onEdit:s})]})}export{Ae as default};
