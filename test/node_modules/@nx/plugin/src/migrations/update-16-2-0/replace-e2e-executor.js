"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
const executor_options_utils_1 = require("@nx/devkit/src/generators/executor-options-utils");
function replaceE2EExecutor(tree) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const projects = (0, devkit_1.getProjects)(tree);
        for (const executor of ['@nx/plugin:e2e', '@nrwl/nx-plugin:e2e']) {
            (0, executor_options_utils_1.forEachExecutorOptions)(tree, executor, (options, project, target, configuration) => {
                var _a;
                const projectConfiguration = projects.get(project);
                const config = Object.assign(Object.assign({}, options), { target: undefined, runInBand: true });
                if (configuration) {
                    projectConfiguration.targets[target].configurations[configuration] =
                        config;
                }
                else {
                    projectConfiguration.targets[target].dependsOn = [
                        ...((_a = projectConfiguration.targets[target].dependsOn) !== null && _a !== void 0 ? _a : []),
                        options.target,
                    ];
                    projectConfiguration.targets[target].executor = '@nx/jest:jest';
                    projectConfiguration.targets[target].options = config;
                }
                (0, devkit_1.updateProjectConfiguration)(tree, project, projectConfiguration);
            });
        }
        yield (0, devkit_1.formatFiles)(tree);
    });
}
exports.default = replaceE2EExecutor;
