{"version":3,"sources":["../../../../../packages/vite/src/utils/executor-utils.ts"],"sourcesContent":["import { printDiagnostics, runTypeCheck } from '@nx/js';\nimport { join, resolve } from 'path';\nimport { ViteBuildExecutorOptions } from '../executors/build/schema';\nimport { ExecutorContext } from '@nx/devkit';\nimport { ViteDevServerExecutorOptions } from '../executors/dev-server/schema';\nimport {\n  calculateProjectDependencies,\n  createTmpTsConfig,\n} from '@nx/js/src/utils/buildable-libs-utils';\nimport { registerTsConfigPaths } from '@nx/js/src/internal';\n\nexport async function validateTypes(opts: {\n  workspaceRoot: string;\n  projectRoot: string;\n  tsconfig: string;\n}): Promise<void> {\n  const result = await runTypeCheck({\n    workspaceRoot: opts.workspaceRoot,\n    tsConfigPath: join(opts.workspaceRoot, opts.tsconfig),\n    mode: 'noEmit',\n  });\n\n  await printDiagnostics(result.errors, result.warnings);\n\n  if (result.errors.length > 0) {\n    throw new Error('Found type errors. See above.');\n  }\n}\n\nexport function registerPaths(\n  projectRoot: string,\n  options: ViteBuildExecutorOptions | ViteDevServerExecutorOptions,\n  context: ExecutorContext\n) {\n  const tsConfig = resolve(projectRoot, 'tsconfig.json');\n  options.buildLibsFromSource ??= true;\n\n  if (!options.buildLibsFromSource) {\n    const { dependencies } = calculateProjectDependencies(\n      context.projectGraph,\n      context.root,\n      context.projectName,\n      context.targetName,\n      context.configurationName\n    );\n    const tmpTsConfig = createTmpTsConfig(\n      tsConfig,\n      context.root,\n      projectRoot,\n      dependencies\n    );\n\n    registerTsConfigPaths(tmpTsConfig);\n  } else {\n    registerTsConfigPaths(tsConfig);\n  }\n}\n"],"names":["validateTypes","registerPaths","opts","result","runTypeCheck","workspaceRoot","tsConfigPath","join","tsconfig","mode","printDiagnostics","errors","warnings","length","Error","projectRoot","options","context","tsConfig","resolve","buildLibsFromSource","dependencies","calculateProjectDependencies","projectGraph","root","projectName","targetName","configurationName","tmpTsConfig","createTmpTsConfig","registerTsConfigPaths"],"mappings":";;;;;;;;IAWsBA,aAAa;eAAbA;;IAkBNC,aAAa;eAAbA;;;oBA7B+B;sBACjB;oCAOvB;0BAC+B;AAE/B,eAAeD,cAAcE,IAInC,EAAiB;IAChB,MAAMC,SAAS,MAAMC,IAAAA,gBAAY,EAAC;QAChCC,eAAeH,KAAKG,aAAa;QACjCC,cAAcC,IAAAA,UAAI,EAACL,KAAKG,aAAa,EAAEH,KAAKM,QAAQ;QACpDC,MAAM;IACR;IAEA,MAAMC,IAAAA,oBAAgB,EAACP,OAAOQ,MAAM,EAAER,OAAOS,QAAQ;IAErD,IAAIT,OAAOQ,MAAM,CAACE,MAAM,GAAG,GAAG;QAC5B,MAAM,IAAIC,MAAM,iCAAiC;IACnD,CAAC;AACH;AAEO,SAASb,cACdc,WAAmB,EACnBC,OAAgE,EAChEC,OAAwB,EACxB;QAEAD;IADA,MAAME,WAAWC,IAAAA,aAAO,EAACJ,aAAa;;IACtCC,yBAAAA,WAAAA,SAAQI,sDAARJ,SAAQI,sBAAwB,IAAI;IAEpC,IAAI,CAACJ,QAAQI,mBAAmB,EAAE;QAChC,MAAM,EAAEC,aAAY,EAAE,GAAGC,IAAAA,gDAA4B,EACnDL,QAAQM,YAAY,EACpBN,QAAQO,IAAI,EACZP,QAAQQ,WAAW,EACnBR,QAAQS,UAAU,EAClBT,QAAQU,iBAAiB;QAE3B,MAAMC,cAAcC,IAAAA,qCAAiB,EACnCX,UACAD,QAAQO,IAAI,EACZT,aACAM;QAGFS,IAAAA,+BAAqB,EAACF;IACxB,OAAO;QACLE,IAAAA,+BAAqB,EAACZ;IACxB,CAAC;AACH"}