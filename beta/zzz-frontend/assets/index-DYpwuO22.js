import{u as L,a as D,r as i,b,j as r,S,C as E,c as p,G as f,T as y,t as C,B as I,d as A,e as G,D as H,f as O,g as P,h as F,i as U,k as V,F as $,l as q,m as Q}from"./index-DcBcdwzQ.js";import{u as K}from"./useForceUpdate-D3L8V5H5.js";function W(){const n=L(),e=D(n.breakpoints.up("sm")),t=D(n.breakpoints.up("md")),s=D(n.breakpoints.up("lg"));return D(n.breakpoints.up("xl"))?"xl":s?"lg":t?"md":e?"sm":"xs"}function _(n){const[e,t]=i.useState(!1),s=i.useRef(null);return!s.current&&typeof window<"u"&&(s.current=new IntersectionObserver(([c])=>t(c.isIntersecting))),i.useEffect(()=>{if(t(!1),!!s.current&&n)return s.current.observe(n),()=>{var c;(c=s.current)==null||c.disconnect()}},[n]),e}function z(n,e){const[t,s]=i.useState(n),[c,a]=i.useState(),u=_(c),[m,h]=K(),d=u&&t<e;return i.useEffect(()=>{e&&s(n)},[e,n]),i.useEffect(()=>{if(!d)return;m&&s(g=>g+n);const o=setTimeout(()=>h(),1e3);return()=>clearTimeout(o)},[m,d,n,h]),{numShow:t,setTriggerElement:a}}function J(n){const[e,t]=i.useState(()=>n==null?void 0:n.get());return i.useEffect(()=>(t(n==null?void 0:n.get()),n==null?void 0:n.follow((s,c)=>s==="update"&&t(c))),[n,t]),e}function M(){const{database:n}=b();return J(n.displayDisc)}function X(n,e){return t=>Object.entries(n).every(([s,c])=>e[s]&&e[s](t,c,n))}function Y({excludedIds:n=[]}={}){return{locked:(e,t)=>!(!t.includes("locked")&&e.lock||!t.includes("unlocked")&&!e.lock),locations:(e,t,s)=>e.location&&!s.showEquipped?t.includes(e.location):!0,showEquipped:()=>!0,showInventory:(e,t)=>e.location?!0:t,discSetKeys:(e,t)=>t.length?t.includes(e.setKey):!0,slotKeys:(e,t)=>t.includes(e.slotKey),mainStatKeys:(e,t)=>t.length?t.includes(e.mainStatKey):!0,levelLow:(e,t)=>t<=e.level,levelHigh:(e,t)=>t>=e.level,rvLow:()=>!0,rvHigh:()=>!0,useMaxRV:()=>!0,rarity:(e,t)=>t.includes(e.rarity),substats:(e,t)=>{for(const s of t)if(s&&!e.substats.some(c=>c.key===s))return!1;return!0},lines:(e,t)=>[0,...t].includes(e.substats.filter(s=>s.upgrades).length),excluded:(e,t)=>!(!t.includes("excluded")&&n.includes(e.id)||!t.includes("included")&&!n.includes(e.id))}}function Z({numShowing:n,total:e,discIds:t}){const s=b().database,{filterOption:c}=M(),a=i.useCallback(u=>s.displayDisc.set({filterOption:{...c,...u}}),[s,c]);return r(i.Suspense,{fallback:r(S,{variant:"rectangular",width:"100%",height:300}),children:r(E,{children:p(O,{children:[p(f,{container:!0,children:[r(f,{item:!0,children:r(y,{variant:"h6",children:C("discFilter")})}),r(f,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:p(y,{children:[r("strong",{children:n})," / ",e]})}),r(f,{item:!0,children:r(I,{size:"small",color:"error",onClick:()=>s.displayDisc.set({action:"reset"}),startIcon:r(A,{}),children:r(G,{t:C,i18nKey:"ui:reset"})})})]}),r(i.Suspense,{fallback:r(S,{variant:"rectangular",width:"100%",height:400}),children:r(H,{filterOption:c,filterOptionDispatch:a,filteredIds:t})})]})})})}const T={xs:2,sm:3,md:4,lg:4,xl:6},ee={xs:10,sm:12,md:24,lg:24,xl:24};function te({onAdd:n,onEdit:e}){const{t}=P("disc"),{database:s}=b(),[c,a]=K(),u=i.useDeferredValue(c),m=M(),h=i.useMemo(()=>Y(),[]),d=i.useDeferredValue(m);i.useEffect(()=>s.discs.followAny(a),[s,a]);const{discIds:o,totalDiscsNum:g}=i.useMemo(()=>{const{filterOption:l}=d,w=s.discs.values;return{discIds:w.filter(X(l,h)).map(R=>R.id),totalDiscsNum:w.length,...u}},[s.discs.values,u,d,h]),j=W(),B=o.length!==g?`${o.length}/${g}`:g,{numShow:k,setTriggerElement:N}=z(ee[j],o.length),x=i.useMemo(()=>o.slice(0,k),[o,k]),v={numShowing:x.length,totalShowing:B};return p($,{children:[r(Z,{numShowing:g,total:g,discIds:o}),r(E,{bgt:"dark",children:r(O,{children:r(F,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:p(y,{color:"text.secondary",children:["Showing ",r("b",{children:v.numShowing})," out of"," ",v.totalShowing," Items"]})})})}),r(f,{container:!0,columns:T,spacing:1,children:r(f,{item:!0,xs:!0,children:r(I,{fullWidth:!0,onClick:n,color:"info",startIcon:r(U,{}),children:t("addNew")})})}),p(i.Suspense,{fallback:r(S,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[r(f,{container:!0,columns:T,spacing:1,children:x.map(l=>r(f,{item:!0,xs:1,children:r(V,{disc:s.discs.get(l),onEdit:()=>e==null?void 0:e(l),onDelete:()=>s.discs.remove(l),setLocation:w=>s.discs.set(l,{location:w}),onLockToggle:()=>s.discs.set(l,({lock:w})=>({lock:!w}))})},l))}),o.length!==x.length&&r(S,{ref:l=>{l&&N(l)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function ie(){const[n,e]=i.useState({}),[t,s,c]=q(),{database:a}=b(),u=i.useCallback(()=>{e({}),s()},[s]),m=i.useCallback(h=>{const d=a.discs.get(h);d&&(e(d),s())},[a.discs,s]);return p(F,{display:"flex",flexDirection:"column",gap:1,my:1,children:[r(Q,{disc:n,allowEmpty:!0,allowUpload:!0,show:t,onClose:c,onShow:s}),r(te,{onAdd:u,onEdit:m})]})}export{ie as default};
