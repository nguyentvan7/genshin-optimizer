(function(){"use strict";const R=(e,t,n)=>e<t?t:e>n?n:e,z=e=>R(e,0,1);function g(e,t){return Object.fromEntries(e.map((n,o)=>[n,t(n,o)]))}function _(e,t){return t===1||Object.keys(e).forEach(n=>{typeof e[n]=="object"&&_(e[n],t),typeof e[n]=="number"&&(e[n]=e[n]*t)}),e}function f(e,t){for(const n in t)e[n]=(e[n]??0)+t[n];return e}const h=["hp","atk","def","hp_","atk_","def_","pen","crit_","crit_dmg_","anomProf"],y=["hp","atk","def","hp_","atk_","def_","crit_","crit_dmg_","anomProf",...["electric_dmg_","fire_dmg_","ice_dmg_","physical_dmg_","ether_dmg_"],"pen_","anomMas_","impact_","enerRegen_"];Array.from(new Set([...h,...y]));const v={AstralVoice:{atk_:.1},BranchBladeSong:{crit_dmg_:.16},ChaosJazz:{anomProf:30},ChaoticMetal:{ether_dmg_:.1},FangedMetal:{physical_dmg_:.1},FreedomBlues:{anomProf:30},HormonePunk:{atk_:.1},InfernoMetal:{fire_dmg_:.1},PolarMetal:{ice_dmg_:.1},ProtoPunk:{shield_:.15},PufferElectro:{pen_:.08},ShockstarDisco:{impact_:.06},SoulRock:{def_:.16},SwingJazz:{enerRegen_:.2},ThunderMetal:{electric_dmg_:.1},WoodpeckerElectro:{crit_:.08}},c={AstralVoice:{key:"AstralVoice",text:e=>`${e} Stacks of Astral`,min:1,max:3},BranchBladeSong:{key:"BranchBladeSong",text:"When any squad member applies Freeze or triggers the Shatter effect on an enemy",min:1,max:1},ChaosJazz:{key:"ChaosJazz",text:"When off-field",min:1,max:1},ChaoticMetal:{key:"ChaoticMetal",text:e=>`${e}x Corruption Triggers`,min:1,max:6},FangedMetal:{key:"FangedMetal",text:"Whenever a squad member inflicts Assault on an enemy",min:1,max:1},HormonePunk:{key:"HormonePunk",text:"Upon entering or switching into combat",min:1,max:1},InfernoMetal:{key:"InfernoMetal",text:"Upon hitting a Burning enemy",min:1,max:1},PolarMetal:{key:"PolarMetal",text:"Whenever a squad member Freezes or Shatters an enemy",min:1,max:1},ProtoPunk:{key:"ProtoPunk",text:"When any squad member triggers a Defensive Assist or Evasive Assist",min:1,max:1},PufferElectro:{key:"PufferElectro",text:"Launching an Ultimate",min:1,max:1},SwingJazz:{key:"SwingJazz",text:"Launching a Chain Attack or Ultimate",min:1,max:1},ThunderMetal:{key:"ThunderMetal",text:"As long as an enemy in combat is Shocked",min:1,max:1},WoodpeckerElectro:{key:"WoodpeckerElectro",text:e=>`${e}x Triggering a critical hit with a Basic Attack, Dodge Counter, or EX Special Attack`,min:1,max:3}},T={AstralVoice:{condMeta:c.AstralVoice,getStats:e=>e.AstralVoice?_({dmg_:.08},e.AstralVoice):void 0},BranchBladeSong:{condMeta:c.BranchBladeSong,getStats:(e,t)=>{const n={};return t.anomMas>=115&&(n.crit_dmg_=.3),e.BranchBladeSong&&(n.crit_=.12),n}},ChaosJazz:{condMeta:c.ChaosJazz,getStats:e=>{const t={fire_dmg_:.15,electric_dmg_:.15};return e.ChaosJazz&&(t.dmg_=.2),t}},ChaoticMetal:{condMeta:c.ChaoticMetal,getStats:e=>{const t={crit_dmg_:.2};return e.ChaoticMetal&&f(t,_({crit_dmg_:.055},e.ChaoticMetal)),t}},FangedMetal:{condMeta:c.FangedMetal,getStats:e=>{if(e.FangedMetal)return{dmg_:.35}}},HormonePunk:{condMeta:c.HormonePunk,getStats:e=>{if(e.HormonePunk)return{cond_atk_:.25}}},InfernoMetal:{condMeta:c.InfernoMetal,getStats:e=>{if(e.InfernoMetal)return{crit_:.28}}},PolarMetal:{condMeta:c.PolarMetal,getStats:e=>{const t={dmg_:.28};return e.PolarMetal&&_(t,2),t}},ProtoPunk:{condMeta:c.ProtoPunk,getStats:e=>{if(e.ProtoPunk)return{dmg_:.15}}},PufferElectro:{condMeta:c.PufferElectro,getStats:e=>{const t={dmg_:.2};return e.PufferElectro&&(t.cond_atk_=.15),t}},SwingJazz:{condMeta:c.SwingJazz,getStats:e=>{if(e.SwingJazz)return{dmg_:.15}}},ThunderMetal:{condMeta:c.ThunderMetal,getStats:e=>{if(e.ThunderMetal)return{cond_atk_:.27}}},WoodpeckerElectro:{condMeta:c.WoodpeckerElectro,getStats:e=>{if(e.WoodpeckerElectro)return _({cond_atk_:.09},e.WoodpeckerElectro)}}},I=["charLvl","enemyDef","enemyDefRed_","enemyRes_","enemyResRed_","enemyResIgn_","dmg_","impact","anomMas","shield_"];Array.from(new Set([...y,...h,...I]));const K=["impact","anomMas","dmg_","shield_"];Array.from(new Set([...y,...h,...K]));const w=["electric_dmg_","fire_dmg_","ice_dmg_","physical_dmg_","ether_dmg_"],p=["burn","shock","corruption","shatter","assault"];({...g(p,e=>`${e} DMG Bonus`)},Object.entries({electric:"Electric",fire:"Fire",ice:"Ice",physical:"Physical",ether:"Ether"}).forEach(([e,t])=>{}));function H(e,t,n){const o={};if(!n.length&&!t.length)return!0;for(const{setKey:a}of e)o[a]=(o[a]||0)+1;if(n.length){let a=!1;for(const r in o){const i=r;if(o[i]>=4&&n.includes(i)){a=!0;break}}if(!a)return!1}if(t.length)for(const a in o){const r=a,i=o[r];if(i===1||i>=2&&i<4&&!t.includes(r))return!1}return!0}function J(e,t,n){var i;const o={...e},a=s=>o[s]||0,r={};for(const{setKey:s}of n)r[s]=(r[s]||0)+1;f(o,r);for(const{stats:s}of n)f(o,s);for(const s in r){const m=s,u=r[m]??0;if(u>=2){const l=v[m];l&&f(o,l)}if(u>=4){const l=(i=T[m])==null?void 0:i.getStats(t,o);l&&f(o,l)}}return o.initial_hp=a("hp_base")*(1+a("hp_"))+a("hp"),o.initial_atk=a("atk_base")*(1+a("atk_"))+a("atk"),o.initial_def=a("def_base")*(1+a("def_"))+a("def"),o.final_hp=a("initial_hp")*(1+a("cond_hp_"))+a("cond_hp"),o.final_atk=a("initial_atk")*(1+a("cond_atk_"))+a("cond_atk"),o.final_def=a("initial_def")*(1+a("cond_def_"))+a("cond_def"),o.impact=a("impact")*(1+a("impact_")),o.anomMas=a("anomMas")*(1+a("anomMas_")),o.crit_=z(o.crit_),o}function W(e,t){return L[t](e)??0}const L={initial_atk:e=>e.initial_atk||0,...g(w,e=>t=>{const n=o=>t[o]||0;return n("final_atk")*(1+n(e)+n("dmg_"))*(1+n("crit_")*n("crit_dmg_"))*M(n)*S(n)}),...g(p,e=>t=>{const n=o=>t[o]||0;return q[e]*n("final_atk")*(n("anomProf")*.01)*(1+1/59*(n("charLvl")-1))*(1+n(U[e])+n("dmg_"))*M(n)*S(n)})};function M(e){const t=V(e("charLvl"));return t/(Math.max(e("enemyDef")*(1-e("enemyDefRed_"))*(1-e("pen_"))-e("pen"),0)+t)}function S(e){return 1-e("enemyRes_")+e("enemyResRed_")+e("enemyResIgn_")}function V(e){return O[e]||794}const O={1:50,2:54,3:58,4:62,5:66,6:71,7:76,8:82,9:88,10:94,11:100,12:107,13:114,14:121,15:129,16:137,17:145,18:153,19:162,20:172,21:181,22:191,23:201,24:211,25:222,26:233,27:245,28:256,29:268,30:281,31:293,32:306,33:319,34:333,35:347,36:361,37:375,38:390,39:405,40:421,41:436,42:452,43:469,44:485,45:502,46:519,47:537,48:555,49:573,50:592,51:610,52:629,53:649,54:669,55:689,56:709,57:730,58:751,59:772,60:794},U={burn:"fire_dmg_",shock:"electric_dmg_",corruption:"ether_dmg_",shatter:"ice_dmg_",assault:"physical_dmg_"},q={burn:.5,shock:1.25,corruption:.625,shatter:5,assault:7.13},P=5e4,N=2e5;let d,E,D,A,C,b,x;onmessage=async e=>{try{await $(e)}catch(t){console.error(t),postMessage({resultType:"err",message:JSON.stringify(t)})}};async function $(e){const{data:t}=e,{command:n}=t;switch(n){case"init":G(t);break;case"start":await j();break}}async function G({baseStats:e,conditionals:t,discStatsBySlot:n,constraints:o,formulaKey:a,setFilter2:r,setFilter4:i}){D=e,A=t,d=n,E=o,C=a,b=r,x=i,postMessage({resultType:"initialized"})}function*X(){for(const e of d[1])for(const t of d[2])for(const n of d[3])for(const o of d[4])for(const a of d[5])for(const r of d[6])yield{d1:e,d2:t,d3:n,d4:o,d5:a,d6:r}}async function j(){let e=[],t=0;function n(){const a=e.length;e.length>P&&(e.sort((r,i)=>i.value-r.value),e=e.slice(0,P)),postMessage({resultType:"results",builds:e,numBuildsComputed:a+t}),e=[],t=0}const o=Object.entries(E);for(const{d1:a,d2:r,d3:i,d4:s,d5:m,d6:u}of X()){const l=[a,r,i,s,m,u];if(!H(l,b,x)){t++;continue}const k=J(D,A,l);o.every(([F,{value:B,isMax:Q}])=>Q?k[F]<=B:k[F]>=B)?e.push({value:W(k,C),discIds:{1:a.id,2:r.id,3:i.id,4:s.id,5:m.id,6:u.id}}):t++,e.length+t>N&&n()}e.length+t>0&&n(),postMessage({resultType:"done"})}})();
