import{n as Re,o as Be,s as Me,_ as Q,r as h,p as Te,q as Oe,v as $e,w as I,x as Ne,y as qe,T as x,z as Y,A as Ue,E as xe,H as be,j as e,I as Ge,J as Ve,b as F,K as Z,L as He,M as Xe,S as Je,N as Qe,F as Ye,O as le,P as N,Q as se,R as Ze,U as ne,V as et,W as tt,X as st,Y as nt,c as o,h as g,Z as it,f as S,C as k,$ as at,a0 as T,a1 as ie,a2 as ve,a3 as _e,a4 as rt,a5 as Ce,B as _,G as R,k as lt,a6 as j,a7 as Se,a8 as ke,a9 as O,aa as B,ab as ot,ac as D,ad as we,ae as K,af as oe,ag as ct,l as dt,ah as q,ai as ut,aj as ht,ak as De,al as Fe,am as ce,g as V,an as pt,ao as Ae,ap as ee,aq as mt,ar as de,as as ft,at as Ie,au as te,av as gt,aw as ue}from"./index-44nYZMYt.js";import{u as yt,a as Ke,g as xt}from"./char-DSzAaNt3.js";import{u as bt}from"./useForceUpdate-VSetotv1.js";function vt(s){return Be("MuiInputAdornment",s)}const _t=Re("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]),he=_t;var pe;const Ct=["children","className","component","disablePointerEvents","disableTypography","position","variant"],St=(s,r)=>{const{ownerState:a}=s;return[r.root,r[`position${Y(a.position)}`],a.disablePointerEvents===!0&&r.disablePointerEvents,r[a.variant]]},kt=s=>{const{classes:r,disablePointerEvents:a,hiddenLabel:i,position:t,size:n,variant:d}=s,u={root:["root",a&&"disablePointerEvents",t&&`position${Y(t)}`,d,i&&"hiddenLabel",n&&`size${Y(n)}`]};return Ue(u,vt,r)},wt=Me("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:St})(({theme:s,ownerState:r})=>Q({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(s.vars||s).palette.action.active},r.variant==="filled"&&{[`&.${he.positionStart}&:not(.${he.hiddenLabel})`]:{marginTop:16}},r.position==="start"&&{marginRight:8},r.position==="end"&&{marginLeft:8},r.disablePointerEvents===!0&&{pointerEvents:"none"})),Dt=h.forwardRef(function(r,a){const i=Te({props:r,name:"MuiInputAdornment"}),{children:t,className:n,component:d="div",disablePointerEvents:u=!1,disableTypography:c=!1,position:m,variant:l}=i,p=Oe(i,Ct),f=$e()||{};let C=l;l&&f.variant,f&&!C&&(C=f.variant);const w=Q({},i,{hiddenLabel:f.hiddenLabel,size:f.size,disablePointerEvents:u,position:m,variant:C}),E=kt(w);return I.jsx(Ne.Provider,{value:null,children:I.jsx(wt,Q({as:d,ownerState:w,className:qe(E.root,n),ref:a},p,{children:typeof t=="string"&&!c?I.jsx(x,{color:"text.secondary",children:t}):I.jsxs(h.Fragment,{children:[m==="start"?pe||(pe=I.jsx("span",{className:"notranslate",children:"â€‹"})):null,t]})}))})}),me=Dt;var ae={},Ft=be;Object.defineProperty(ae,"__esModule",{value:!0});var Le=ae.default=void 0,At=Ft(xe()),It=I,Kt=(0,At.default)((0,It.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");Le=ae.default=Kt;function Lt(s){return e(Ge,{placement:"top",...s,children:e(Le,{sx:{cursor:"help"}})})}function U({value:s,onChange:r,float:a=!1,...i}){const[t,n]=h.useState(s==null?void 0:s.toString()),{min:d,max:u}=(i==null?void 0:i.inputProps)??{};h.useEffect(()=>{n(s==null?void 0:s.toString())},[s]);const c=()=>{const p=a?t.replace(",","."):t;let f=a?parseFloat(p):parseInt(p);if(isNaN(f)&&(f=0,n(f.toString())),d!==void 0&&f<d){r(d),n(d.toString());return}if(u!==void 0&&f>u){r(u),n(u.toString());return}r(f)},m=p=>{const f=p.target.value;if(f.match(a?/[^0-9.,-]/:/[^0-9-]/))return p.preventDefault();n(f)},l=p=>{p.target.select()};return e(Ve,{value:t==null?void 0:t.toString(),onChange:m,onBlur:c,onFocus:l,onKeyDown:p=>p.key==="Enter"&&!i.multiline&&c(),...i,inputProps:{inputMode:"numeric",...i.inputProps??{}}})}function Et(s){const{database:r}=F();return yt(r.discs,s??"")}function Wt(s){return He.wengine[s]}function Pt(s,r){const{atk_base:a,second_statkey:i,second_statvalue:t}=Wt(s),n=Z(Math.floor(r/10),0,5);return{atk_base:a*(1+zt[r]/1e4+.8922*n),[i]:t*(1+.3*n)}}const zt=[0,1568,3136,4705,6273,7841,9409,10977,12545,14114,15682,17250,18818,20386,21954,23523,25091,26659,28227,29795,31363,32932,34500,36068,37636,39204,40772,42341,43909,45477,47045,48613,50181,51750,53318,54886,56454,58022,59590,61159,62727,64295,65863,67431,68999,70568,72136,73704,75272,76840,78408,79977,81545,83113,84681,86249,87817,89386,90954,92522,94090];function jt({wkey:s,setWKey:r,...a}){const i=h.useMemo(()=>[{key:"",label:"Select a Wengine"},...Xe.map(t=>({key:t,label:t}))],[]);return e(h.Suspense,{fallback:e(Je,{variant:"text",width:100}),children:e(Qe,{size:"small",options:i,toImg:()=>e(Ye,{children:" "}),valueKey:s,onChange:t=>r(t??""),...a})})}function Rt(s,r,a){var d;const i={...s},t=u=>i[u]||0,n={};for(const{setKey:u}of a)n[u]=(n[u]||0)+1;N(i,n);for(const{stats:u}of a)N(i,u);for(const u in n){const c=u,m=n[c]??0;if(m>=2){const l=tt[c];l&&N(i,l)}if(m>=4){const l=(d=se[c])==null?void 0:d.getStats(r,i);l&&N(i,l)}}return i.initial_hp=t("hp_base")*(1+t("hp_"))+t("hp"),i.initial_atk=t("atk_base")*(1+t("atk_"))+t("atk"),i.initial_def=t("def_base")*(1+t("def_"))+t("def"),i.final_hp=t("initial_hp")*(1+t("cond_hp_"))+t("cond_hp"),i.final_atk=t("initial_atk")*(1+t("cond_atk_"))+t("cond_atk"),i.final_def=t("initial_def")*(1+t("cond_def_"))+t("cond_def"),i.impact=t("impact")*(1+t("impact_")),i.anomMas=t("anomMas")*(1+t("anomMas_")),i.crit_=Ze(i.crit_),i}({...le(ne,s=>r=>{const a=i=>r[i]||0;return a("final_atk")*(1+a(s)+a("dmg_"))*(1+a("crit_")*a("crit_dmg_"))*fe(a)*ge(a)}),...le(et,s=>r=>{const a=i=>r[i]||0;return Ot[s]*a("final_atk")*(a("anomProf")*.01)*(1+1/59*(a("charLvl")-1))*(1+a(Tt[s])+a("dmg_"))*fe(a)*ge(a)})});function fe(s){const r=Bt(s("charLvl"));return r/(Math.max(s("enemyDef")*(1-s("enemyDefRed_"))*(1-s("pen_"))-s("pen"),0)+r)}function ge(s){return 1-s("enemyRes_")+s("enemyResRed_")+s("enemyResIgn_")}function Bt(s){return Mt[s]||794}const Mt={1:50,2:54,3:58,4:62,5:66,6:71,7:76,8:82,9:88,10:94,11:100,12:107,13:114,14:121,15:129,16:137,17:145,18:153,19:162,20:172,21:181,22:191,23:201,24:211,25:222,26:233,27:245,28:256,29:268,30:281,31:293,32:306,33:319,34:333,35:347,36:361,37:375,38:390,39:405,40:421,41:436,42:452,43:469,44:485,45:502,46:519,47:537,48:555,49:573,50:592,51:610,52:629,53:649,54:669,55:689,56:709,57:730,58:751,59:772,60:794},Tt={burn:"fire_dmg_",shock:"electric_dmg_",corruption:"ether_dmg_",shatter:"ice_dmg_",assault:"physical_dmg_"},Ot={burn:.5,shock:1.25,corruption:.625,shatter:5,assault:7.13},$t=5e4;function Nt(...s){const r={};return s.forEach(a=>Object.entries(a).forEach(([i,t])=>{r[i]=(r[i]??0)+t})),r}function qt(s){const{id:r,mainStatKey:a,level:i,rarity:t,setKey:n,substats:d}=s;return{id:r,stats:{[a]:st(t,a),...Object.fromEntries(d.map(({key:u,upgrades:c})=>[u,nt(u,t)*c]))},setKey:n}}class Ut{constructor(r,a,i,t,n,d,u,c,m){this.formulaKey=r,this.baseStats=a,this.conditionals=i,this.constraints=t,this.discsBySlot=u,this.numWorkers=c,this.setProgress=m,this.setFilter2=n,this.setFilter4=d,this.worker=new Worker(new URL(""+new URL("parentWorker-Bbu9X0T3.js",import.meta.url).href,import.meta.url),{type:"module"})}async optimize(){return await new Promise((a,i)=>{this.worker.onmessage=({data:n})=>{switch(n.resultType){case"progress":this.setProgress(n.progress);break;case"done":a(n.buildResults);break;case"err":console.error(n),i();break}};const t={baseStats:this.baseStats,conditionals:this.conditionals,command:"start",discsBySlot:this.discsBySlot,constraints:this.constraints,numWorkers:this.numWorkers,formulaKey:this.formulaKey,setFilter2:this.setFilter2,setFilter4:this.setFilter4};this.worker.postMessage(t)})}async terminate(){const r={command:"terminate"};this.worker.postMessage(r),await new Promise((a,i)=>{this.worker.onmessage=({data:t})=>{switch(t.resultType){case"terminated":a();break;case"err":console.error(t),i();break}}}),this.worker.terminate()}}const Gt=["hp_base","atk_base","def_base"],Vt=["hp","atk","def","hp_","atk_","def_","crit_","crit_dmg_",...ne,"dmg_","impact","anomMas","anomProf","pen_","pen"],Ht=["enemyDef","enemyDefRed_","enemyRes_","enemyResRed_","enemyResIgn_"];function Xt({locationKey:s,baseStats:r,setBaseStats:a}){const i=t=>e(U,{disabled:!s,sx:{flexGrow:1,whiteSpace:"nowrap"},value:r[t]||0,onChange:n=>a({...r,[t]:n}),float:at(t),inputProps:{sx:{textAlign:"right",minWidth:"5em"}},InputProps:{startAdornment:e(T,{statKey:t}),endAdornment:ie(t)}},t);return e(k,{children:o(S,{children:[e(x,{children:"BONUS Character Base Stats"}),e(g,{sx:{display:"flex",gap:1,pb:2,flexWrap:"wrap"},children:Gt.map(t=>i(t))}),e(x,{children:"BONUS Character Stats"}),e(g,{sx:{display:"flex",gap:1,pb:2,flexWrap:"wrap"},children:Vt.map(t=>i(t))}),e(x,{children:"Enemy Stats"}),e(g,{sx:{display:"flex",gap:1,pb:2,flexWrap:"wrap"},children:Ht.map(t=>i(t))}),e(x,{children:"Combat Buffs"}),e(g,{sx:{display:"flex",gap:1,pb:2,flexWrap:"wrap"},children:it.map(t=>i(t))})]})})}const Ee=h.createContext(void 0);function L(){return h.useContext(Ee)}function G({stats:s,showBase:r=!1}){return e(g,{sx:{columnWidth:"15em"},children:Object.entries(s).filter(([a])=>r||!a.endsWith("_base")).map(([a,i])=>o(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(T,{statKey:a},a)," ",e("span",{children:ve(i,ie(a))})]},a))})}function Jt({location:s,builds:r,stats:a}){return e(_e,{spacing:1,children:r.map((i,t)=>e(Qt,{locationKey:s,index:t,build:i,baseStats:a},`${t}_${i.value}`))})}function Qt({locationKey:s,index:r,build:a,baseStats:i}){const{database:t}=F(),n=L(),d=h.useMemo(()=>Rt(i,(n==null?void 0:n.conditionals)??{},Object.values(a.discIds).map(c=>t.discs.get(c)).filter(rt).map(qt)),[i,a.discIds,n,t.discs]),u=h.useCallback(()=>{Object.values(a.discIds).forEach(c=>{t.discs.set(c,{location:s})})},[t.discs,s,a.discIds]);return e(k,{children:o(S,{children:[o(g,{sx:{display:"flex",gap:1},children:[e(x,{children:e(Ce,{children:r+1})}),o(x,{sx:{flexGrow:1},children:["Calculated Value: ",e("strong",{children:ve(a.value)})]}),o(_,{size:"small",disabled:!s,onClick:u,children:["Equip to ",s]})]}),e(G,{stats:d}),e(g,{children:e(R,{container:!0,spacing:1,columns:{xs:2,sm:3,md:3,lg:4,xl:6},children:Object.values(a.discIds).map(c=>e(R,{item:!0,xs:1,children:e(Yt,{discId:c},c)},c))})})]})})}function Yt({discId:s}){const{database:r}=F(),a=Et(s);if(a)return e(lt,{disc:a,setLocation:i=>r.discs.set(s,{location:i})})}function Zt({baseStats:s}){return o(k,{children:[e(O,{title:"Disc 4p Set Conditionals"}),e(B,{}),o(S,{children:[e(x,{children:"Conditionals only take effect when characters are equipped with the 4p."}),e(g,{children:e(R,{container:!0,spacing:1,children:Object.keys(se).map(r=>e(R,{item:!0,xs:6,children:e(es,{setKey:r,baseStats:s},r)},r))})})]})]})}function es({setKey:s,baseStats:r}){const a=se[s],i=L(),t=h.useMemo(()=>i&&(a==null?void 0:a.getStats)&&a.getStats(i==null?void 0:i.conditionals,r),[r,i,a]);if(!a||!i)return null;const{condMeta:n}=a;return o(k,{bgt:"light",children:[e(O,{title:e(j,{setKey:s}),avatar:e(Se,{src:ke(s),size:2})}),e(B,{}),e(S,{children:e(x,{children:e(ot,{setKey:s})})}),e(ts,{condMeta:n}),!!t&&!!Object.keys(t).length&&e(S,{children:e(G,{stats:t})})]})}function ts({condMeta:s}){const{database:r}=F(),a=L(),i=a.conditionals[s.key]??0;return s.max>1?o(K,{fullWidth:!0,value:i,color:i?"success":"primary",title:typeof s.text=="function"?s.text(i):s.text,sx:{borderRadius:0},children:[e(D,{onClick:()=>{r.chars.set(a.key,t=>({conditionals:{...t.conditionals,[s.key]:void 0}}))},children:"Clear"}),we(s.min,s.max).map(t=>e(D,{value:t,onClick:()=>{r.chars.set(a.key,n=>({conditionals:{...n.conditionals,[s.key]:t}}))},children:typeof s.text=="function"?s.text(t):s.text},t))]}):s.max===1?e(_,{fullWidth:!0,sx:{borderRadius:0},color:i?"success":"primary",onClick:()=>r.chars.set(a.key,t=>({conditionals:{...t.conditionals,[s.key]:+!i}})),children:s.text}):null}var re={},ss=be;Object.defineProperty(re,"__esModule",{value:!0});var We=re.default=void 0,ns=ss(xe()),is=I,as=(0,ns.default)((0,is.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");We=re.default=as;const rs=h.memo(function({locationKey:r,disabled:a=!1}){const{database:i}=F(),t=Ke(r);return o(k,{bgt:"light",children:[e(S,{sx:{display:"flex",gap:1},children:e(x,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),e(B,{}),e(ls,{levelLow:(t==null?void 0:t.levelLow)??15,levelHigh:(t==null?void 0:t.levelHigh)??15,setLow:n=>t&&i.chars.set(t.key,{levelLow:n}),setHigh:n=>t&&i.chars.set(t.key,{levelHigh:n}),setBoth:(n,d)=>t&&i.chars.set(t.key,{levelLow:n,levelHigh:d}),disabled:a||!t})]})});function ls({levelLow:s,levelHigh:r,setLow:a,setHigh:i,setBoth:t,dark:n=!1,disabled:d=!1}){const[u,c]=h.useState(s),[m,l]=h.useState(r),p=h.useCallback((f,C)=>{if(typeof C=="number")throw new TypeError;const[w,E]=C;c(w),l(E)},[c,l]);return h.useEffect(()=>c(s),[c,s]),h.useEffect(()=>l(r),[l,r]),o(g,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:n?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[e(g,{sx:{width:"max-content",height:32,display:"flex"},children:e(oe,{value:u,onChange:f=>a(Z(f??0,0,r)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:"center"}},disabled:d})}),e(ct,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Arifact Level Range",value:[u,m],onChange:p,onChangeCommitted:(f,C)=>Array.isArray(C)&&t(C[0],C[1]),valueLabelDisplay:"auto",min:0,max:15,step:1,marks:!0,disabled:d}),e(oe,{value:m,onChange:f=>i(Z(f??0,s,15)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:d})]})}function os({disabled:s=!1}){const{database:r}=F(),[a,i,t]=dt(),n=L(),{setFilter2:d=[],setFilter4:u=[],key:c}=n??{};return o(k,{bgt:"light",children:[e(ut,{open:a,onClose:t,children:e(cs,{onClose:t})}),o(S,{sx:{display:"flex",gap:1},children:[o(g,{sx:{flexGrow:1,display:"flex",gap:1,flexDirection:"column"},children:[u.length<=1?o(K,{disabled:s,title:u[0]?o("span",{children:["Force 4-Set:"," ",e("strong",{children:e(j,{setKey:u[0]})})]}):"Select to force 4-Set",sx:{flexGrow:1},children:[e(D,{onClick:()=>c&&r.chars.set(c,{setFilter4:[]}),children:"No 4-Set"}),q.map(m=>e(D,{onClick:()=>c&&r.chars.set(c,{setFilter4:[m]}),children:e(j,{setKey:m})},m))]}):e(_,{disabled:!0,children:o("span",{children:[e("strong",{children:u.length})," Disc 4p-set Selected"]})}),d.length<=1?o(K,{disabled:s,title:d[0]?o("span",{children:["Force 2-Set:"," ",e("strong",{children:e(j,{setKey:d[0]})})]}):"Select to force 2-Set",sx:{flexGrow:1},children:[e(D,{onClick:()=>c&&r.chars.set(c,{setFilter2:[]}),children:"No 2-Set"}),q.map(m=>e(D,{onClick:()=>c&&r.chars.set(c,{setFilter2:[m]}),children:e(j,{setKey:m})},m))]}):e(_,{disabled:!0,children:o("span",{children:[e("strong",{children:d.length})," Disc 2p-set Selected"]})})]}),e(g,{sx:{display:"flex",alignItems:"stretch"},children:e(_,{disabled:s,onClick:i,color:"info",children:"Advanced Set-Filter Config"})})]})]})}function cs({onClose:s}){const{database:r}=F(),a=L(),{setFilter2:i=[],setFilter4:t=[],key:n}=a??{};return o(k,{children:[e(O,{title:"Advanced Set-Filter Config",action:e(ht,{onClick:s,children:e(De,{})})}),e(B,{}),o(S,{children:[o(g,{sx:{display:"flex",gap:1,mb:1},children:[e(_,{disabled:!t.length,onClick:()=>n&&r.chars.set(n,{setFilter4:[]}),children:"Reset 4p filter"}),e(_,{disabled:!i.length,onClick:()=>n&&r.chars.set(n,{setFilter2:[]}),children:"Reset 2p filter"})]}),e(R,{container:!0,spacing:1,children:q.map(d=>e(R,{item:!0,xs:1,md:2,lg:3,children:e(ds,{setKey:d})},d))})]})]})}function ds({setKey:s}){const{database:r}=F(),a=L(),{setFilter2:i=[],setFilter4:t=[],key:n}=a??{};return o(k,{bgt:"light",children:[e(O,{title:e(j,{setKey:s}),avatar:e(Se,{src:ke(s),size:2})}),o(Fe,{fullWidth:!0,children:[e(_,{color:!t.length||t.includes(s)?"success":"secondary",onClick:()=>n&&r.chars.set(n,{setFilter4:t.length?ce([...t],s):[s]}),children:"Allow 4p"}),e(_,{color:!i.length||i.includes(s)?"success":"secondary",onClick:()=>n&&r.chars.set(n,{setFilter2:i.length?ce([...i],s):[s]}),children:"Allow 2p"})]})]})}const us=["hp","def","atk","crit_","crit_dmg_","anomProf","pen",...ne];function hs({constraints:s,setConstraints:r,disabled:a=!1}){const{t:i}=V("page_character_optimize");return e(g,{children:o(k,{bgt:"light",children:[e(S,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:o(g,{display:"flex",justifyContent:"space-between",children:[e(x,{sx:{fontWeight:"bold"},children:i("constraintFilter.title")}),e(Lt,{title:e(x,{children:i("constraintFilter.tooltip")})})]})}),e(B,{}),e(S,{children:o(_e,{spacing:1,children:[Object.entries(s).filter(([t])=>!q.includes(t)).map(([t,{value:n,isMax:d}])=>o(g,{display:"flex",gap:1,children:[e(U,{value:n,onChange:u=>r({...s,[t]:{value:u,isMax:d}}),inputProps:{sx:{textAlign:"right"}},InputProps:{startAdornment:e(T,{statKey:t}),endAdornment:ie(t)}}),o(Fe,{size:"small",children:[e(_,{onClick:()=>r({...s,[t]:{value:n,isMax:!d}}),children:d?"MAX":"MIN"}),e(_,{onClick:()=>{const{[t]:u,...c}=s;r({...c})},children:e(pt,{})})]})]},t)),e(K,{disabled:a,title:"Add new Constraint",children:us.filter(t=>!Object.keys(s).includes(t)).map(t=>e(D,{onClick:()=>r({...s,[t]:{value:0,isMax:!1}}),children:e(T,{statKey:t})},t))})]})})]})})}function ps({numWorkers:s,setNumWorkers:r}){const{t:a}=V("optimize"),i=navigator.hardwareConcurrency||8;return e(K,{title:`${a("numWorkers")}: ${s}`,children:we(1,i).map(t=>o(D,{onClick:()=>r(t),children:[t," Workers"]},t))})}function ms({formulaKey:s,location:r,baseStats:a,setResults:i}){const{t}=V("optimize"),{database:n}=F(),[d,u]=h.useState(8),[c,m]=h.useState(void 0),l=L();h.useEffect(()=>{m(void 0)},[l]);const p=h.useCallback(y=>{l&&n.chars.set(l.key,{constraints:y})},[n,l]),[f,C]=bt();h.useEffect(()=>n.discs.followAny(C),[n.discs,C]);const w=h.useMemo(()=>f&&n.discs.values.reduce((y,b)=>{if(!l)return y;const{levelLow:P,levelHigh:A,useEquipped:v,slot4:z,slot5:J,slot6:je}=l;return b.level<P||b.level>A||b.location&&!v&&b.location!==r||b.slotKey==="4"&&!z.includes(b.mainStatKey)||b.slotKey==="5"&&!J.includes(b.mainStatKey)||b.slotKey==="6"&&!je.includes(b.mainStatKey)||y[b.slotKey].push(b),y},{1:[],2:[],3:[],4:[],5:[],6:[]}),[f,n.discs.values,r,l]),E=h.useMemo(()=>Object.values(w).reduce((y,b)=>y*b.length,1),[w]),[$,H]=h.useState(!1),M=h.useRef(()=>{});h.useEffect(()=>()=>M.current(),[]);const Pe=h.useCallback(async()=>{if(!l)return;const{setFilter2:y,setFilter4:b}=l,P=new Promise(z=>M.current=z);i([]),m(void 0),H(!0);const A=new Ut(s,a,l.conditionals,Ae(l.constraints,(z,J)=>({...z,value:Ie(z.value,J)})),y,b,w,d,m);P.then(async()=>await A.terminate());const v=await A.optimize();await A.terminate(),M.current=()=>{},H(!1),i(v)},[a,l,w,s,d,i]),ze=h.useCallback(()=>{M.current(),H(!1)},[M]),W=y=>o(x,{children:["Disc ",y," ",e(Ce,{children:w[y].length})]}),X=y=>{const b=mt([...de[y]]),P={4:(l==null?void 0:l.slot4)??[],5:(l==null?void 0:l.slot5)??[],6:(l==null?void 0:l.slot6)??[]},A={4:v=>l&&n.chars.set(l.key,{slot4:v}),5:v=>l&&n.chars.set(l.key,{slot5:v}),6:v=>l&&n.chars.set(l.key,{slot6:v})};return e(g,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:de[y].map(v=>e(_,{disabled:!l,variant:P[y].includes(v)?"contained":"outlined",onClick:()=>A[y](b([...P[y]],v)),children:e(T,{statKey:v,showPercent:!0})},v))})};return o(k,{children:[e(O,{title:t("optimize")}),e(B,{}),e(S,{children:o(ee,{spacing:1,children:[e(hs,{disabled:!l,constraints:(l==null?void 0:l.constraints)??{},setConstraints:p}),e(rs,{locationKey:r}),e(k,{bgt:"light",children:e(S,{children:o(ee,{spacing:1,children:[o(g,{sx:{display:"flex",justifyContent:"space-between"},children:[W("1"),W("2"),W("3")]}),W("4"),X("4"),W("5"),X("5"),W("6"),X("6")]})})}),e(os,{disabled:!l}),e(_,{disabled:!l,onClick:()=>l&&n.chars.set(l.key,{useEquipped:!l.useEquipped}),color:l!=null&&l.useEquipped?"success":"secondary",children:"Use equipped Discs"}),e(x,{children:e("strong",{children:"NOTE: the solver currently accounts for 2-set effects only."})}),o(g,{sx:{display:"flex",gap:1},children:[e(ps,{numWorkers:d,setNumWorkers:u}),e(_,{sx:{flexGrow:1},onClick:$?ze:Pe,color:$?"error":"success",startIcon:$?e(De,{}):e(We,{}),disabled:!E||!l,children:t($?"cancel":"optimize")})]}),c&&e(fs,{progress:c,totalPermutations:E})]})})]})}function fs({progress:s,totalPermutations:r}){const{t:a}=V("optimize");return o(g,{children:[o(x,{children:[a("totalProgress"),": ",s.numBuildsComputed.toLocaleString()," /"," ",r.toLocaleString()]}),o(x,{children:[a("buildsKept"),": ",s.numBuildsKept.toLocaleString()," /"," ",$t.toLocaleString()]}),e(ft,{variant:"determinate",value:s.numBuildsComputed/r*100})]})}function gs({disabled:s=!1,formulaKey:r,setFormulaKey:a}){return e(K,{disabled:s,fullWidth:!0,title:o("span",{children:["Optimize Target: ",e("strong",{children:ye[r]})]}),sx:{flexGrow:1},children:te.map(i=>e(D,{onClick:()=>a(i),children:ye[i]},i))})}const ye={initial_atk:"Initial ATK",electric_dmg_:"Electrical Damage",fire_dmg_:"Fire Damage",ice_dmg_:"Ice Damage",physical_dmg_:"Physical Damage",ether_dmg_:"Ether Damage",burn:"Burn Anomaly",shock:"Shock Anomaly",corruption:"Corruption Anomaly",shatter:"Shatter Anomaly",assault:"Assault Anomaly"};function vs(){const{database:s}=F(),[r,a]=h.useState([]),[i,t]=h.useState(""),n=Ke(i)??(i?s.chars.getOrCreate(i):void 0),d=h.useCallback(p=>{n&&s.chars.set(n.key,{stats:p})},[n,s.chars]),u=h.useMemo(()=>{if(n)return xt(n.key,n.level,n.core)},[n]),c=h.useMemo(()=>{if(n)return Pt(n.wengineKey,n.wengineLvl)},[n]),m=h.useMemo(()=>n?Nt(u??{},c??{},Ae(n.stats,(p,f)=>Ie(p,f))):{},[u,n,c]),l=h.useCallback(p=>{n&&s.chars.set(n.key,{formulaKey:p})},[n,s.chars]);return e(Ee.Provider,{value:n,children:o(g,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(k,{children:e(S,{children:o(ee,{spacing:1,children:[e(x,{variant:"h6",children:"Character"}),o(g,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(gt,{locKey:i,setLocKey:p=>{t(p),a([])},sx:{flexGrow:1},autoFocus:!0}),e(U,{disabled:!n,value:(n==null?void 0:n.level)??60,onChange:p=>p!==void 0&&n&&s.chars.set(n.key,{level:p}),size:"small",inputProps:{sx:{width:"2ch"},max:60,min:1},InputProps:{startAdornment:e(me,{position:"start",children:"Lv."})}}),e(K,{title:`Core: ${ue[(n==null?void 0:n.core)??0]}`,disabled:!n,children:ue.map((p,f)=>e(D,{onClick:()=>n&&s.chars.set(n.key,{core:f}),children:p},p))})]}),u&&e(G,{stats:u,showBase:!0}),e(gs,{disabled:!n,formulaKey:(n==null?void 0:n.formulaKey)??te[0],setFormulaKey:l}),e(x,{variant:"h6",children:"Wengine"}),o(g,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(jt,{disabled:!n,wkey:(n==null?void 0:n.wengineKey)??"",setWKey:p=>p&&n&&s.chars.set(n.key,{wengineKey:p}),sx:{flexGrow:1},autoFocus:!0}),e(U,{disabled:!n,value:(n==null?void 0:n.wengineLvl)??60,onChange:p=>p!==void 0&&n&&s.chars.set(n.key,{wengineLvl:p}),size:"small",inputProps:{sx:{width:"2ch"},max:60,min:1},InputProps:{startAdornment:e(me,{position:"start",children:"Lv."})}})]}),c&&e(G,{stats:c,showBase:!0})]})})}),e(Xt,{locationKey:i,baseStats:(n==null?void 0:n.stats)??{},setBaseStats:d}),e(Zt,{baseStats:m}),e(ms,{setResults:a,baseStats:m,location:i,formulaKey:(n==null?void 0:n.formulaKey)??te[0]}),e(Jt,{builds:r,stats:m,location:i})]})})}export{vs as default};
